---
layout: post
title: "Кэш и ненависть в iBooks"
description: ""
category: 
tags: [ibooks, wtf]
---
{% include JB/setup %}

Разрабатывая книгу, мы столкнулись с «необъяснимыми» проблемами с HTML5 AUDIO в написанных нами HTML-виджетах. Аудио то играло, то не играло, при звук иногда пропадал после исправлений, которые не затрагивали ни JS, ни HTML, ни CSS ( например после замены дефисов на тире ). Долгим и, к сожалению, эмпирическим путем мы установили корень проблемы — *кириллица в имени файла книги и в имени файла виджета*. Вроде бы все легко — переименовываем книгу, переименовываем виджет, бинго! С файлом книги, естественно, проблем не возникло, а с виджетом все оказалось чуть-чуть сложнее.

**В iBooks Author никто не может просто взять, переименовать виджет.** Программа имеет свой механизм кэширования. Упрощенная модель кэша работает примерно так:

1.	Получаем хэш файла, который пользователь пытается добавить в книгу.
2.	Сверяем хэш файла с хэшами уже существующих файлов этого типа.
3.	Основываясь на результате предыдущего пункта, решаем, использовать ли новый файл, либо сослаться на файл, который уже существует в книге.

Можно очень долго пытаться добавить переименованый латиницей файл в книгу, но **пока в не добавишь хотя бы один пробел в виджет — iBooks** не станет добавлять виджет, и вместо этого **будет ссылаться на уже существующий файл, который не будет работать из-за кириллицы в названии.**