<h2 id='____'>«Что круче: числа или строки?»</h2>

<p>Часто возникает желание узнать, что же все-таки круче: «A» или «B». Например, сегодня я задумался — насколько медленнее работает поиск по подстроке против чисел. Да-да, именно так «насколько медленнее&#8230;». Задача — реализация прав доступа.</p>

<h2 id='id1'>Экспозиция</h2>

<ul>
<li>
<p><strong>Unix Way</strong>: права задаются в виде восьмеричного числа, которое конвертируется в двоичное, и каждый разряд этого числа отвечает за определенный тип прав. Например 5 в восмеричной — это 101 в двоичной. И теперь по порядку: 1 — администрирование, 0 — нет редактирования, 1 — чтение.</p>
</li>

<li>
<p><strong>Строки</strong>: права задаются в виде строки которая состоит из букв «rwa», где «r» — чтение, «w» — редактирование, «a» — администрирование.</p>
</li>
</ul>

<p>Для меня было очевидно, что поиск по подстроке должен быть медленнее, чем «простая математика». Но мне было интересно, на сколько медленнее. Я ждал каких-то космических значений, ибо гениальное unix-way решение выглядело очень по-гиковски. Мне казалось, что разница должна была быть в раза в три.</p>

<h2 id='____'>Как узнать, что же круче?!</h2>

<p>В Dash у меня хранится специальный скрипт. Я нашел его в дебрях комментариев хабра, и теперь всегда использую для того, чтобы проверить, какое из решений быстрее. Я нахожу это занятие очень забавным.</p>

<pre><code>// from: habrahabr.ru/ somewhere in comments
// Полезная штука для того, чтобы оценить какой оператор или конструкция быстрее.
function count(f, q){
    console.profile()
    while(q--){
        f();
    }
    console.profileEnd()
}
function f1( x ){
    return typeof x == &#39;undefined&#39;;
}
function f2( x ){
    return typeof x === &#39;undefined&#39;;
}

count(f1, 10000000000);
count(f2, 10000000000);</code></pre>

<h2 id='1__111'>Нууу!!1 Что круче??!!111один</h2>

<p>В результате, пытаясь минимально сгладить различия между двумя реализациями, у меня получился следующий код.</p>

<pre><code>function count(f, q){
    console.profile()
    while(q--){
        f();
    }
    console.profileEnd()
}
function f1( x ){

    var data = [7, 5, 1];

    for (var i = 0; i &lt; data.length; i++) {
      var r = data[i];
      r[0]==1 ? &#39;read&#39; : false;
      r[1]==1 ? &#39;write&#39; : false;
      r[2]==1 ? &#39;admin&#39; : false;
    }

}


function f2( x ){

    var data = [&#39;r&#39;, &#39;rw&#39;, &#39;rwa&#39;];

    for (var i = 0; i &lt; data.length; i++) {
      var r = data[i];

      !! ~r.indexOf(&#39;r&#39;) ? &#39;read&#39; : false;
      !! ~r.indexOf(&#39;w&#39;) ? &#39;write&#39; : false;
      !! ~r.indexOf(&#39;a&#39;) ? &#39;admin&#39; : false;
    }

}

count(f1, 10000000);
count(f2, 10000000);</code></pre>

<h2 id='1'>Отвечай!!!!1</h2>

<p>Неожиданно, все вышло совсем не так. Числа знатно прососали буквам. Мир никогда не будет прежним. Смотрите сами:</p>

<ul>
<li><strong>Unix Way</strong>: 5962ms</li>

<li><strong>Строки</strong>: 4989ms</li>
</ul>

<h2 id='id2'>Мораль</h2>

<p>Все эти псевдоинтеллектуальные исследования в одном браузере вряд ли имеют какой-то смысл, но делать «зарубки на лавках» как видишь, очень весело! Советую, взять на вооружение этот удобный сниппет для, так сказать, a/b тестирования.</p>